{% extends "base.html" %}

{% block title %}Rewards Shop - GenConnect{% endblock %}

{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&display=swap" rel="stylesheet">

<style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body { 
        background: 
            linear-gradient(rgba(248, 250, 252, 0.92), rgba(248, 250, 252, 0.92)),
            url('https://images.unsplash.com/photo-1517694712202-14dd9538aa97?w=1600&fit=crop');
        background-size: cover;
        background-attachment: fixed;
        background-position: center;
        
        font-family: 'Outfit', -apple-system, sans-serif; 
        color: #1e293b;
    }

    /* --- SIDEBAR (EXACT MATCH TO MESSAGES.HTML) --- */
    .container { display: flex; min-height: 100vh; }
    
    .sidebar { 
        position: fixed; left: 0; top: 0; width: 250px; height: 100vh; 
        background-color: white; border-right: 1px solid #e5e7eb; 
        padding: 20px 0; z-index: 100; display: flex; flex-direction: column;
    }

    .sidebar-logo { padding: 0 30px 20px; border-bottom: 1px solid #e5e7eb; margin-bottom: 20px; }
    .logo { display: flex; align-items: center; gap: 10px; font-size: 20px; font-weight: 600; color: #6366f1; text-decoration: none; }
    
    .sidebar-nav { list-style: none; padding: 0; margin: 0; flex: 1; }
    .sidebar-nav li { margin: 5px 0; }
    
    .sidebar-nav a { 
        display: flex; align-items: center; gap: 15px; padding: 12px 30px; 
        text-decoration: none; color: #374151; transition: all 0.2s; font-size: 15px; border-radius: 0; 
    }
    .sidebar-nav a:hover { background-color: #f9fafb; }
    .sidebar-nav a.active { background-color: #eff6ff; color: #2563eb; border-right: 3px solid #2563eb; }
    .sidebar-nav svg { width: 22px; height: 22px; }

    /* --- MAIN CONTENT --- */
    .main-content { margin-left: 250px; flex: 1; padding: 40px; }
    .rewards-container { max-width: 1100px; margin: 0 auto; }
    
    /* --- REWARDS SPECIFIC STYLES --- */
    .shop-header {
        background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
        border-radius: 24px; padding: 40px; color: white;
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 40px; box-shadow: 0 10px 30px rgba(79, 70, 229, 0.3);
    }
    
    .header-text h1 { font-size: 32px; font-weight: 800; margin-bottom: 8px; }
    .points-display {
        background: rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px);
        padding: 15px 30px; border-radius: 16px; border: 1px solid rgba(255,255,255,0.3);
        text-align: center;
    }
    .points-val { font-size: 36px; font-weight: 800; display: block; }
    .points-lbl { font-size: 12px; text-transform: uppercase; font-weight: 700; letter-spacing: 1px; }

    /* Daily Claim Card */
    .daily-section {
        background: white; border-radius: 20px; padding: 25px;
        border: 1px solid #e2e8f0; margin-bottom: 40px;
        display: flex; align-items: center; justify-content: space-between;
        box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
    }
    .daily-info h3 { font-size: 18px; font-weight: 700; color: #1e293b; margin-bottom: 5px; }
    .claim-btn {
        background: #10b981; color: white; border: none; padding: 12px 30px;
        border-radius: 12px; font-weight: 700; font-size: 15px; cursor: pointer;
        transition: 0.2s; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }
    .claim-btn:hover { transform: translateY(-2px); background: #059669; }
    .claim-btn:disabled { background: #cbd5e1; cursor: not-allowed; transform: none; box-shadow: none; }

    /* Rewards Grid */
    .grid-title { font-size: 20px; font-weight: 800; color: #1e293b; margin-bottom: 20px; }
    .rewards-grid {
        display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px;
    }
    
    .reward-card {
        background: white; border-radius: 20px; padding: 25px;
        border: 1px solid #e2e8f0; transition: 0.3s;
        display: flex; flex-direction: column; align-items: center; text-align: center;
    }
    .reward-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); border-color: #6366f1; }
    
    .reward-icon {
        width: 80px; height: 80px; background: #f8fafc; border-radius: 50%;
        display: flex; align-items: center; justify-content: center; font-size: 32px;
        margin-bottom: 15px; border: 1px solid #e2e8f0;
    }
    .reward-h { font-size: 18px; font-weight: 700; color: #1e293b; margin-bottom: 8px; }
    .reward-p { font-size: 14px; color: #64748b; margin-bottom: 20px; line-height: 1.5; }
    
    .cost-badge {
        background: #fffbeb; color: #b45309; padding: 6px 14px; border-radius: 20px;
        font-weight: 700; font-size: 14px; border: 1px solid #fcd34d; margin-bottom: 15px;
    }
    
    .redeem-btn {
        width: 100%; padding: 12px; border: 2px solid #4f46e5;
        background: transparent; color: #4f46e5; border-radius: 12px;
        font-weight: 700; cursor: pointer; transition: 0.2s;
    }
    .redeem-btn:hover { background: #4f46e5; color: white; }

    @media (max-width: 1024px) {
        .sidebar { display: none; }
        .main-content { margin-left: 0; }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <aside class="sidebar">
        <div class="sidebar-logo">
            <a href="/" class="logo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
                <span>GenConnect</span>
            </a>
        </div>
        <ul class="sidebar-nav">
            <li><a href="{{ url_for('home') }}"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg><span>Home</span></a></li>
            <li><a href="#"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="10" r="3"/><path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662"/></svg><span>Activities</span></a></li>
            <li><a href="#"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg><span>Community</span></a></li>
            <li><a href="#"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg><span>Create</span></a></li>
            <li><a href="#"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg><span>Alerts</span></a></li>
            <li><a href="{{ url_for('messages') }}"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><span>Chat</span></a></li>
            <li><a href="{{ url_for('profile') }}" class="active"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span>Profile</span></a></li>
            
            <li style="margin-top: 20px; border-top: 1px solid #e5e7eb;"></li>
            <li><a href="#" style="color: #059669;"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/><path d="M12 8v8"/></svg><span>Senior Mode (Aa+)</span></a></li>
            <li><a href="{{ url_for('logout') }}"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg><span>Logout</span></a></li>
        </ul>
    </aside>

    <main class="main-content">
        <div class="rewards-container">
            <div class="shop-header">
                <div class="header-text">
                    <h1>Rewards Shop</h1>
                    <p>Spend your hard-earned GenPoints on community perks!</p>
                </div>
                <div class="points-display">
                    <span class="points-val" id="displayPoints">{{ user.points }}</span>
                    <span class="points-lbl">Available Points</span>
                </div>
            </div>

            <div class="daily-section">
                <div class="daily-info">
                    <h3>ðŸ“… Daily Attendance</h3>
                    <p style="color:#64748b; font-size:14px;">Check in every day to earn a bonus +50 points.</p>
                </div>
                <button class="claim-btn" id="dailyBtn" onclick="claimDailyPoints()">Claim +50 Points</button>
            </div>

            <h2 class="grid-title">Community Perks</h2>
            <div class="rewards-grid">
                <div class="reward-card">
                    <div class="reward-icon">ðŸŽ¨</div>
                    <div class="reward-h">Profile Frame</div>
                    <p class="reward-p">Stand out with a special gold border around your avatar.</p>
                    <div class="cost-badge">500 GenPoints</div>
                    <button class="redeem-btn" onclick="redeemItem(500, 'Profile Frame')">Redeem</button>
                </div>
                <div class="reward-card">
                    <div class="reward-icon">ðŸ”¥</div>
                    <div class="reward-h">Post Spotlight</div>
                    <p class="reward-p">Pin one of your posts to the top of the community feed.</p>
                    <div class="cost-badge">300 GenPoints</div>
                    <button class="redeem-btn" onclick="redeemItem(300, 'Post Spotlight')">Redeem</button>
                </div>
                <div class="reward-card">
                    <div class="reward-icon">ðŸŽ«</div>
                    <div class="reward-h">Event Fast-Pass</div>
                    <p class="reward-p">Get priority seating at the next community workshop.</p>
                    <div class="cost-badge">200 GenPoints</div>
                    <button class="redeem-btn" onclick="redeemItem(200, 'Event Fast-Pass')">Redeem</button>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
    let currentPoints = parseInt("{{ user.points }}") || 0;
    
    // Check if already claimed today
    const lastClaimDate = localStorage.getItem('lastClaimDate');
    const today = new Date().toDateString();
    
    if(lastClaimDate === today) {
        const btn = document.getElementById('dailyBtn');
        btn.disabled = true;
        btn.innerText = "Claimed Today";
    }

    function claimDailyPoints() {
        currentPoints += 50;
        updatePointsUI();
        localStorage.setItem('lastClaimDate', new Date().toDateString());
        
        const btn = document.getElementById('dailyBtn');
        btn.disabled = true;
        btn.innerText = "Claimed!";
        
        alert("Success! You claimed 50 points.");
    }

    function redeemItem(cost, itemName) {
        if(currentPoints >= cost) {
            if(confirm(`Spend ${cost} points on ${itemName}?`)) {
                currentPoints -= cost;
                updatePointsUI();
                alert(`Successfully redeemed: ${itemName}!`);
            }
        } else {
            alert("Not enough points!");
        }
    }

    function updatePointsUI() {
        document.getElementById('displayPoints').innerText = currentPoints;
    }
</script>
{% endblock %}