{% extends "base.html" %}

{% block title %}Edit Profile - GenConnect{% endblock %}

{% block extra_css %}
<style>
    /* --- RESET & BASE --- */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background-color: #f3f4f6; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }

    .container { display: flex; min-height: 100vh; }

    /* --- SIDEBAR --- */
    .sidebar {
        position: fixed; left: 0; top: 0; width: 250px; height: 100vh;
        background-color: white; border-right: 1px solid #e5e7eb; padding: 20px 0; z-index: 100;
    }
    .sidebar-logo { padding: 0 30px 20px; border-bottom: 1px solid #e5e7eb; margin-bottom: 20px; display: flex; align-items: center; gap: 10px; color: #2563eb; font-weight: 700; font-size: 20px; }
    .sidebar-nav { list-style: none; }
    .sidebar-nav a { display: flex; align-items: center; gap: 15px; padding: 12px 30px; text-decoration: none; color: #4b5563; transition: all 0.2s; font-size: 15px; font-weight: 500; }
    .sidebar-nav a:hover { background-color: #f9fafb; color: #111827; }
    .sidebar-nav a.active { background-color: #eff6ff; color: #2563eb; border-right: 3px solid #2563eb; }
    .sidebar-nav svg { width: 22px; height: 22px; }

    /* --- MAIN CONTENT AREA --- */
    .main-content { margin-left: 250px; flex: 1; padding: 40px; background-color: #fff; }
    
    /* --- EDIT FORM STYLES --- */
    .edit-container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 12px;
        padding: 40px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 40px;
        padding-bottom: 20px;
        border-bottom: 1px solid #f3f4f6;
    }

    .page-title { font-size: 24px; font-weight: 700; color: #111827; }

    .btn-save {
        background-color: #2563eb; color: white; border: none; padding: 10px 24px;
        border-radius: 6px; font-weight: 600; cursor: pointer; transition: background-color 0.2s;
    }
    .btn-save:hover { background-color: #1d4ed8; }

    /* Avatar Section */
    .avatar-edit-section { display: flex; flex-direction: column; align-items: center; margin-bottom: 40px; }
    .avatar-preview {
        width: 120px; height: 120px; border-radius: 50%; overflow: hidden;
        margin-bottom: 15px; border: 4px solid #f9fafb; box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    }
    .avatar-preview img { width: 100%; height: 100%; object-fit: cover; }
    .change-photo-btn {
        color: #2563eb; background: none; border: none; font-size: 14px; font-weight: 600; cursor: pointer;
    }
    .change-photo-btn:hover { text-decoration: underline; }

    /* Form Grid */
    .form-grid { display: grid; gap: 24px; }
    .form-row { display: grid; grid-template-columns: 150px 1fr; align-items: start; gap: 20px; }
    .form-label { font-size: 14px; font-weight: 600; color: #374151; padding-top: 10px; }
    .form-input, .form-select, .form-textarea {
        width: 100%; padding: 10px 14px; border: 1px solid #d1d5db; border-radius: 8px;
        font-size: 14px; background-color: #fff; transition: border-color 0.2s;
    }
    .form-input:focus, .form-textarea:focus { outline: none; border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
    .form-textarea { min-height: 100px; resize: vertical; }

    /* Hobbies Checkboxes */
    .hobbies-grid {
        display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;
        background: #f9fafb; padding: 20px; border-radius: 8px; border: 1px solid #e5e7eb;
    }
    .checkbox-item { display: flex; align-items: center; gap: 8px; font-size: 14px; color: #4b5563; cursor: pointer; }

    /* Delete Section */
    .delete-section { margin-top: 50px; padding-top: 30px; border-top: 1px solid #e5e7eb; text-align: center; }
    .btn-delete-trigger {
        background-color: #fee2e2; color: #dc2626; border: none; padding: 12px 30px;
        border-radius: 8px; font-weight: 600; cursor: pointer; transition: background-color 0.2s;
    }
    .btn-delete-trigger:hover { background-color: #fecaca; }

    /* Modal */
    .modal {
        display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 1000;
    }
    .modal.active { display: flex; }
    .modal-content {
        background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 400px;
        text-align: center; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
    }
    .modal-title { font-size: 18px; font-weight: 700; margin-bottom: 10px; color: #111827; }
    .modal-text { color: #6b7280; font-size: 14px; margin-bottom: 25px; line-height: 1.5; }
    .modal-actions { display: flex; gap: 10px; justify-content: center; }
    .btn-cancel { background: #f3f4f6; color: #374151; padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: 500; }
    .btn-confirm-delete { background: #dc2626; color: white; padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; font-weight: 500; }

    @media (max-width: 768px) {
        .sidebar { width: 70px; }
        .sidebar-nav a span { display: none; }
        .main-content { margin-left: 70px; padding: 20px; }
        .form-row { grid-template-columns: 1fr; gap: 8px; }
        .hobbies-grid { grid-template-columns: 1fr 1fr; }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <aside class="sidebar">
        <div class="sidebar-logo">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg>
            <span>GenConnect</span>
        </div>
        <ul class="sidebar-nav">
            <li><a href="{{ url_for('home') }}"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg><span>Home</span></a></li>
            <li><a href="#"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="10" r="3"/><path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662"/></svg><span>Explore Activities</span></a></li>
            <li><a href="#"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg><span>Community</span></a></li>
            <li><a href="#"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg><span>Create</span></a></li>
            <li><a href="#"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg><span>Notification</span></a></li>
            <li><a href="{{ url_for('messages') }}"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><span>Messages</span></a></li>
            <li><a href="{{ url_for('profile') }}" class="active"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span>Profile</span></a></li>
            <li><a href="{{ url_for('logout') }}"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg><span>Logout</span></a></li>
        </ul>
    </aside>

    <main class="main-content">
        <form method="POST" action="{{ url_for('edit_profile') }}" enctype="multipart/form-data" class="edit-container">
            <div class="page-header">
                <h1 class="page-title">Edit Profile</h1>
                <button type="submit" class="btn-save">Save</button>
            </div>

            <div class="avatar-edit-section">
                <div class="avatar-preview">
                    <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=400&h=400&fit=crop" alt="Profile">
                </div>
                <button type="button" class="change-photo-btn">Change Profile Photo</button>
                <input type="file" name="profile_picture" style="display: none;" id="photoInput">
            </div>

            <div class="form-grid">
                <div class="form-row">
                    <label class="form-label">Username</label>
                    <input type="text" name="username" class="form-input" value="{{ user.username }}" required>
                </div>
                <div class="form-row">
                    <label class="form-label">Email</label>
                    <input type="email" name="email" class="form-input" value="{{ user.email }}" required>
                </div>
                <div class="form-row">
                    <label class="form-label">Gender</label>
                    <select class="form-select">
                        <option>Prefer not to say</option>
                        <option>Male</option>
                        <option>Female</option>
                    </select>
                </div>
                <div class="form-row">
                    <label class="form-label">Bio</label>
                    <textarea name="bio" class="form-textarea">{{ user.bio or '' }}</textarea>
                </div>
                <div class="form-row">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-input" placeholder="+65 9123 4567">
                </div>
                <div class="form-row">
                    <label class="form-label">Hobbies</label>
                    <div class="hobbies-grid">
                        {% set interests = user.interests.split(',') if user.interests else [] %}
                        {% set all_hobbies = ['Writing', 'Photography', 'Traveling', 'Videography', 'Music', 'Reading', 'Hiking', 'Sports', 'Cooking'] %}
                        
                        {% for hobby in all_hobbies %}
                        <label class="checkbox-item">
                            <input type="checkbox" name="interests" value="{{ hobby }}" 
                                {% if hobby in interests %}checked{% endif %}>
                            {{ hobby }}
                        </label>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="delete-section">
                <button type="button" class="btn-delete-trigger" onclick="openDeleteModal()">Delete Account</button>
            </div>
        </form>
    </main>
</div>

<div class="modal" id="deleteModal">
    <div class="modal-content">
        <div class="modal-title">Delete Account</div>
        <p class="modal-text">You will permanently lose your account and all contributed data. This action cannot be undone.</p>
        <div class="modal-actions">
            <button class="btn-cancel" onclick="closeDeleteModal()">Cancel</button>
            <form action="{{ url_for('delete_account') }}" method="POST" style="display: inline;">
                <button type="submit" class="btn-confirm-delete">Delete</button>
            </form>
        </div>
    </div>
</div>

<script>
    document.querySelector('.change-photo-btn').addEventListener('click', () => {
        document.getElementById('photoInput').click();
    });

    function openDeleteModal() {
        document.getElementById('deleteModal').classList.add('active');
    }

    function closeDeleteModal() {
        document.getElementById('deleteModal').classList.remove('active');
    }

    document.getElementById('deleteModal').addEventListener('click', function(e) {
        if (e.target === this) closeDeleteModal();
    });
</script>
{% endblock %}