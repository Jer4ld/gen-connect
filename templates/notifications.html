<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications - GenConnect</title>
    <style>
        /* Base Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #f5f5f5; }
        .container { display: flex; min-height: 100vh; }

        /* Sidebar Styles */
        .sidebar { position: fixed; left: 0; top: 0; width: 250px; height: 100vh; background-color: white; border-right: 1px solid #e5e7eb; padding: 20px 0; z-index: 100; }
        .sidebar-logo { padding: 0 30px 20px; border-bottom: 1px solid #e5e7eb; margin-bottom: 20px; }
        
        .logo { display: flex; align-items: center; gap: 8px; font-size: 18px; font-weight: 600; color: #6366f1; text-decoration: none; }
        .logo svg { width: 18px; height: 18px; }

        .sidebar-nav { list-style: none; }
        .sidebar-nav li { margin: 5px 0; }
        .sidebar-nav a { display: flex; align-items: center; gap: 15px; padding: 12px 30px; text-decoration: none; color: #374151; transition: all 0.2s; font-size: 15px; }
        .sidebar-nav a:hover { background-color: #f9fafb; }
        .sidebar-nav a.active { background-color: #eff6ff; color: #2563eb; border-right: 3px solid #2563eb; }
        .sidebar-nav svg { width: 20px; height: 20px; flex-shrink: 0; }

        /* Main Content Layout */
        .main-content { 
            margin-left: 250px; 
            flex: 1; 
            padding: 40px; 
            background-color: #f9fafb; 
            min-height: 100vh; 
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .notification-wrapper {
            width: 100%;
            max-width: 800px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }

        .notif-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 20px 25px;
            border-bottom: 1px solid #f3f4f6;
            background: white;
        }
        
        .notif-header h2 { font-size: 20px; color: #111827; font-weight: 700; margin: 0; }
        
        .mark-read-btn {
            font-size: 13px;
            color: #2563eb;
            font-weight: 500;
            background: none;
            border: none;
            cursor: pointer;
        }
        .mark-read-btn:hover { text-decoration: underline; }

        .notif-list { display: flex; flex-direction: column; }
        
        .notif-card { 
            padding: 20px 25px; 
            border-bottom: 1px solid #f3f4f6; 
            display: flex; 
            flex-direction: column;
            gap: 10px;
            position: relative;
            transition: background 0.2s;
        }
        
        .notif-card:hover { background-color: #f9fafb; }
        .notif-card:last-child { border-bottom: none; }

        /* Unread Indicator */
        .notif-card.unread { background-color: #f0f9ff; }
        .notif-card.unread::after {
            content: '';
            position: absolute;
            top: 24px;
            right: 25px;
            width: 8px;
            height: 8px;
            background-color: #2563eb;
            border-radius: 50%;
        }

        .notif-info h4 { 
            font-size: 13px; 
            color: #6366f1; 
            margin-bottom: 6px; 
            text-transform: uppercase; 
            letter-spacing: 0.5px; 
            font-weight: 700;
        }
        
        /* Red color for negative notifications */
        .notif-info h4.alert { color: #ef4444; }

        .notif-info p { font-size: 15px; color: #374151; margin: 0; line-height: 1.4; }
        
        .btn-group { display: flex; gap: 10px; margin-top: 5px; }
        .btn { padding: 8px 16px; border-radius: 6px; border: none; font-size: 13px; font-weight: 600; cursor: pointer; transition: opacity 0.2s; }
        .accept-btn { background: #10b981; color: white; }
        .accept-btn:hover { opacity: 0.9; }
        .reject-btn { background: #fee2e2; color: #ef4444; }
        .reject-btn:hover { background: #fecaca; }
        
        .time-stamp { font-size: 12px; color: #9ca3af; margin-top: 5px; display: block; }
        .empty-state { text-align: center; padding: 60px 20px; color: #9ca3af; }
    </style>
</head>
<body>
<div class="container">
    <aside class="sidebar">
        <div class="sidebar-logo">
            <a href="/" class="logo">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/>
                </svg>
                <span>GenConnect</span>
            </a>
        </div>
        <ul class="sidebar-nav">
            <li><a href="/home"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg><span>Home</span></a></li>
            <li><a href="#"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="10" r="3"/><path d="M7 20.662V19a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v1.662"/></svg><span>Explore Activities</span></a></li>
            <li><a href="#"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg><span>Community</span></a></li>
            <li><a href="#"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg><span>Create</span></a></li>
            <li><a href="/notifications" class="active"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg><span>Notification</span></a></li>
            <li><a href="/messages"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><span>Messages</span></a></li>
            <li><a href="/profile"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span>Profile</span></a></li>
            <li><a href="/logout"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg><span>Logout</span></a></li>
        </ul>
    </aside>

    <main class="main-content">
        <div class="notification-wrapper">
            <div class="notif-header">
                <h2>Notifications</h2>
                <button class="mark-read-btn" onclick="markAllAsRead()">Mark all as read</button>
            </div>

            <div class="notif-list">
                {% for n in notifications if n.status == 'pending' or n.type in ['request_accepted', 'group_joined', 'request_rejected', 'contact_removed', 'group_removal'] %}
                
                <div class="notif-card {% if n.status == 'pending' %}unread{% endif %}" id="notif-{{ n.id }}">
                    <div class="notif-info">
                        <h4 class="{% if n.type in ['request_rejected', 'contact_removed', 'group_removal'] %}alert{% endif %}">
                            {{ n.type.replace('_', ' ') }}
                        </h4>
                        <p>{{ n.message }}</p>
                        
                        {% if n.status == 'pending' and n.type in ['contact_request', 'group_invite'] %}
                        <div class="btn-group">
                            <button class="btn accept-btn" data-id="{{ n.id }}" onclick="respondToInvite(this, 'accept')">Accept</button>
                            <button class="btn reject-btn" data-id="{{ n.id }}" onclick="respondToInvite(this, 'reject')">Decline</button>
                        </div>
                        {% else %}
                        <span class="time-stamp">{{ n.created_at.strftime('%b %d, %H:%M') }}</span>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <div class="empty-state">
                    <p>No new notifications at the moment.</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </main>
</div>

<script>
    async function respondToInvite(buttonElement, action) {
        const notifId = buttonElement.getAttribute('data-id');
        const card = document.getElementById(`notif-${notifId}`);
        
        // Disable buttons immediately
        const btns = card.querySelectorAll('.btn');
        btns.forEach(b => b.disabled = true);
        buttonElement.innerText = "Processing...";

        try {
            const response = await fetch(`/respond_notification/${notifId}/${action}`, { method: 'POST' });
            const data = await response.json();
            
            if (data.success) {
                card.style.opacity = '0';
                setTimeout(() => {
                    card.remove();
                    const list = document.querySelector('.notif-list');
                    if (list.children.length === 0) {
                        list.innerHTML = '<div class="empty-state"><p>No new notifications at the moment.</p></div>';
                    }
                }, 300);
            } else {
                alert("Error: " + data.message);
                btns.forEach(b => b.disabled = false);
            }
        } catch (err) {
            console.error("Error:", err);
            btns.forEach(b => b.disabled = false);
        }
    }

    async function markAllAsRead() {
        document.querySelectorAll('.notif-card.unread').forEach(c => c.classList.remove('unread'));
        // Optional backend call
        // fetch('/mark_notifications_read', { method: 'POST' });
    }
</script>
</body>
</html>